{% extends 'base.html' %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<h2>{{ title }}</h2>
<form method="post">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="mb-3">
        <label for="id_name" class="form-label">Name</label>
        <input type="text" class="form-control" id="id_name" name="name"
               value="{{ form.name.value|default:'' }}">
        {% for error in form.name.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label for="id_species" class="form-label">Species</label>
        <input type="text" class="form-control" id="id_species" name="species"
               value="{{ form.species.value|default:'' }}">
        {% for error in form.species.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label for="id_variety" class="form-label">Variety</label>
        <input type="text" class="form-control" id="id_variety" name="variety"
               value="{{ form.variety.value|default:'' }}">
        {% for error in form.variety.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label for="id_planting_date" class="form-label">Planting Date</label>
        <div class="input-group">
            <input type="datetime-local" class="form-control" id="id_planting_date" name="planting_date"
                   value="{{ form.planting_date.value|default:''|date:'Y-m-d\\TH:i' }}">
            <button type="button" class="btn btn-secondary" onclick="setNow()">Now</button>
        </div>
        {% for error in form.planting_date.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label for="id_cultivation" class="form-label">Cultivation</label>
        <select class="form-control" id="id_cultivation" name="cultivation">
            <option value="" {% if not form.cultivation.value %}selected{% endif %}>---------</option>
            {% for option in form.cultivation.field.queryset %}
                <option value="{{ option.id }}" {% if option.id|stringformat:"s" == form.cultivation.value|stringformat:"s" %}selected{% endif %}>{{ option }}</option>
            {% endfor %}
        </select>
        {% for error in form.cultivation.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label for="id_environment" class="form-label">Environment</label>
        <select class="form-control" id="id_environment" name="environment">
            <option value="" {% if not form.environment.value %}selected{% endif %}>---------</option>
            {% for option in form.environment.field.queryset %}
                <option value="{{ option.id }}" {% if option.id|stringformat:"s" == form.environment.value|stringformat:"s" %}selected{% endif %}>{{ option }}</option>
            {% endfor %}
        </select>
        {% for error in form.environment.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label for="id_growth_stage" class="form-label">Growth Stage</label>
        <select class="form-control" id="id_growth_stage" name="growth_stage">
            <option value="" {% if not form.growth_stage.value %}selected{% endif %}>---------</option>
            {% for choice in form.growth_stage.field.choices %}
                <option value="{{ choice.0 }}" {% if choice.0|stringformat:"s" == form.growth_stage.value|stringformat:"s" %}selected{% endif %}>{{ choice.1 }}</option>
            {% endfor %}
        </select>
        {% for error in form.growth_stage.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label for="id_notes" class="form-label">Notes</label>
        <textarea class="form-control" id="id_notes" name="notes">{{ form.notes.value|default:'' }}</textarea>
        {% for error in form.notes.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label for="id_height" class="form-label">Height</label>
        <input type="number" step="0.01" class="form-control" id="id_height" name="height"
               value="{{ form.height.value|default:'' }}">
        {% for error in form.height.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div class="mb-3">
        <label for="id_trunk_diameter" class="form-label">Trunk Diameter</label>
        <input type="number" step="0.01" class="form-control" id="id_trunk_diameter" name="trunk_diameter"
               value="{{ form.trunk_diameter.value|default:'' }}">
        {% for error in form.trunk_diameter.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <button type="submit" class="btn btn-primary">Save</button>
    <a href="/plants/" class="btn btn-secondary">Cancel</a>
</form>

<script>
    function setNow() {
        const now = new Date();
        const formattedDate = now.toISOString().slice(0, 16); // Formato para datetime-local
        document.getElementById('id_planting_date').value = formattedDate;
    }
</script>
{% endblock %}
